ðŸŽ“ IELTS Tutor RAG Agent (åŸºäºŽ Qwen2.5-7B çš„é›…æ€æ™ºèƒ½åŠ©æ•™)
----An Advanced RAG Agent for IELTS Preparation running locally. 
     ä¸€ä¸ªåŸºäºŽ Qwen2.5-7Bã€LangGraph å’Œæ··åˆæ£€ç´¢æŠ€æœ¯æž„å»ºçš„å…·å¤‡è‡ªæˆ‘åæ€ä¸Žæ£€ç´¢ä¼˜åŒ–èƒ½åŠ›çš„æœ¬åœ°åŒ–é›…æ€å¤‡è€ƒåŠ©æ‰‹ã€‚å®žçŽ°äº†ä½Žèµ„æºä¸‹çš„ Agentic RAG
	
ðŸ’¡ ä¸ºä»€ä¹ˆåšè¿™ä¸ªé¡¹ç›®ï¼Ÿ
foræ­£åœ¨å¤‡è€ƒé›…æ€çš„å­¦ç”Ÿï¼Œé€šç”¨å¤§æ¨¡åž‹åœ¨å›žç­”å…·ä½“çš„è¯„åˆ†æ ‡å‡†ï¼ˆå¦‚ Band Descriptorsï¼‰æ—¶ç»å¸¸äº§ç”Ÿå¹»è§‰ï¼Œæ— æ³•å…·å¤‡é’ˆå¯¹æ€§çš„æå‡ºæ‰¹æ”¹å»ºè®®è¿›è¡Œä¼˜åŒ–ã€‚é€šè¿‡æž„å»ºè¿™ä¸ª RAG ç³»ç»Ÿï¼Œæˆ‘ä¸ä»…æ·±å…¥å®žè·µäº† Retrieval-Augmented Generation å’Œ Agentic AI çš„ç”¨æ³•ï¼Œå¹¶ä¸”å®žçŽ°åœ¨æœ‰é™ç®—åŠ›ä¸‹çš„æ€§èƒ½ä¼˜åŒ–ã€‚ï¼ˆå°†LLMç»™GPU,embeddingã€rerankerç»™CPUï¼Œå®žçŽ°åœ¨3060-6Gä¸‹è·‘é€š7Bæ¨¡åž‹ï¼‰

ä¼ ç»Ÿ RAGï¼šæ£€ç´¢ -> ç”Ÿæˆ -> ç»“æŸï¼Œæ˜¯ä¸€æ¡ç›´çº¿ã€‚

ç›®æ ‡Agentï¼šæ£€ç´¢ -> ç”Ÿæˆ -> æ£€æŸ¥ -> å‘çŽ°ä¸å¯¹ -> æ”¹å†™é—®é¢˜ -> é‡æ–°æ£€ç´¢ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ†çŽ¯ã€‚


ðŸ“– é¡¹ç›®ç®€ä»‹ (Introduction)
æœ¬é¡¹ç›®æ—¨åœ¨æž„å»ºä¸€ä¸ªä½Žæˆæœ¬ã€é«˜éšç§ã€ä¸“ä¸šåŒ–çš„é›…æ€åŠ©æ•™ã€‚é¡¹ç›®åŸºäºŽ Ollama æœ¬åœ°éƒ¨ç½²çš„ Qwen2.5-7B æ¨¡åž‹ï¼Œç»åŽ†äº†ä»Žâ€œåŸºç¡€ RAGâ€åˆ°â€œé«˜çº§ Agentâ€çš„è¿­ä»£å¼€å‘ã€‚

ä¸ä»…å®žçŽ°äº†åŸºäºŽæ–‡æ¡£çš„çŸ¥è¯†é—®ç­”ï¼Œæ›´å¼•å…¥äº† LangGraph çŠ¶æ€æœºï¼Œä½¿æ¨¡åž‹å…·å¤‡äº†è‡ªæˆ‘åæ€å’Œ æŸ¥è¯¢æ”¹å†™çš„èƒ½åŠ›ï¼Œæœ‰æ•ˆè§£å†³äº†ä¼ ç»Ÿ RAG ç³»ç»Ÿä¸­â€œæ£€ç´¢ä¸ç²¾å‡†â€å’Œâ€œå›žç­”å¹»è§‰â€çš„ç—›ç‚¹ã€‚

ðŸ› ï¸ æŠ€æœ¯æž¶æž„æ¼”è¿› (Architecture Evolution)
ç¬¬ä¸€é˜¶æ®µï¼šåŸºçº¿ç³»ç»Ÿ (Baseline RAG)  ragchat.py

æœ€åˆæ­å»ºäº†ä¸€ä¸ªåŸºäºŽ LangChain + ChromaDB çš„æ ‡å‡†çº¿æ€§ RAG ç³»ç»Ÿã€‚

çº¿æ€§æµç¨‹ (Linear Pipeline): éµå¾ª Retrieve (æ£€ç´¢) -> Augment (å¢žå¼º) -> Generate (ç”Ÿæˆ) çš„æ ‡å‡†èŒƒå¼ã€‚

Prompt å·¥ç¨‹ä¼˜åŒ–: é’ˆå¯¹åŸºçº¿æ¨¡åž‹å›žç­”æ­»æ¿çš„é—®é¢˜ï¼Œè®¾è®¡äº† â€œæ··åˆæ¨¡å¼â€ (Hybrid Mode) Promptã€‚

ç³»ç»Ÿèƒ½åŠ¨æ€åˆ¤æ–­ç”¨æˆ·æ„å›¾ï¼šå¦‚æžœæ˜¯é—²èŠï¼Œä½¿ç”¨æ¨¡åž‹å†…ç”ŸçŸ¥è¯†ï¼ˆInternal Knowledgeï¼‰ï¼›å¦‚æžœæ˜¯ä¸“ä¸šé—®é¢˜ï¼Œå¼ºåˆ¶åŸºäºŽå¤–éƒ¨çŸ¥è¯†åº“ï¼ˆExternal Knowledgeï¼‰å›žç­”ã€‚

å‘é‡æ£€ç´¢: ä½¿ç”¨ ChromaDB è¿›è¡Œä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆCosine Similarityï¼‰æœç´¢ï¼Œå¬å›ž Top-3 ç›¸å…³æ–‡æ¡£ã€‚

ç¬¬äºŒé˜¶æ®µï¼šAdvanced Agentic RAG  agent_rag.py

é’ˆå¯¹åŸºçº¿ç‰ˆæœ¬ä¸­ä¸“æœ‰åè¯ä¸¢å¤±ä»¥åŠå›žç­”é€»è¾‘å•ä¸€çš„é—®é¢˜ï¼Œå¼•å…¥äº† Agentic Workflow è¿›è¡Œé‡æž„ã€‚

1. æ£€ç´¢å¢žå¼º (Advanced Retrieval)
ä¸ºäº†è§£å†³çº¯å‘é‡æ£€ç´¢çš„å±€é™æ€§ï¼Œæž„å»ºäº†å¤šè·¯å¬å›žä¸Žç²¾æŽ’æœºåˆ¶ï¼š

æ··åˆæ£€ç´¢ (Hybrid Search):

BM25: è´Ÿè´£å…³é”®è¯åŒ¹é…ï¼Œè§£å†³â€œé›…æ€ç‰¹å®šæœ¯è¯­ï¼ˆå¦‚ TR, GRA, Task 1ï¼‰â€åœ¨çº¯è¯­ä¹‰ç©ºé—´ä¸­å®¹æ˜“è¢«å¿½ç•¥çš„é—®é¢˜ã€‚

Vector Search: è´Ÿè´£è¯­ä¹‰åŒ¹é…ï¼Œç†è§£ç”¨æˆ·é—®é¢˜çš„æ·±å±‚å«ä¹‰ã€‚

é€šè¿‡ EnsembleRetriever å¯¹ä¸¤è€…ç»“æžœè¿›è¡ŒåŠ æƒèžåˆã€‚

é‡æŽ’åº (Re-ranking):

å¼•å…¥ Cross-Encoder æ¨¡åž‹ï¼ˆbge-rerankerï¼‰ï¼Œåƒâ€œé˜…å·è€å¸ˆâ€ä¸€æ ·å¯¹å¬å›žçš„æ–‡æ¡£è¿›è¡Œç»†ç²’åº¦æ‰“åˆ†ã€‚

è¿‡æ»¤æŽ‰ç›¸å…³æ€§ä½Žçš„å™ªéŸ³æ–‡æ¡£ï¼Œä»…ä¿ç•™ Top-3 é«˜ç½®ä¿¡åº¦ç‰‡æ®µç»™å¤§æ¨¡åž‹ï¼Œå¤§å¹…å‡å°‘å¹»è§‰ã€‚

2. æ™ºèƒ½ä½“å·¥ä½œæµ (Agentic Workflow with LangGraph)
æ”¾å¼ƒäº†å•å‘é“¾æ¡ï¼Œä½¿ç”¨ LangGraph æž„å»ºäº†ä¸€ä¸ªæœ‰çŽ¯å›¾ (Cyclic Graph) çŠ¶æ€æœºï¼š

è‡ªæˆ‘åæ€ (Self-Reflection): æ¨¡åž‹ç”Ÿæˆç­”æ¡ˆåŽï¼Œä¼šè§¦å‘ Hallucination Check èŠ‚ç‚¹ï¼Œè‡ªæŸ¥â€œæˆ‘çš„å›žç­”æ˜¯å¦æœ‰æ–‡æ¡£ä¾æ®ï¼Ÿâ€

æŸ¥è¯¢æ”¹å†™ (Query Rewriting): å¦‚æžœè‡ªæŸ¥ä¸é€šè¿‡ï¼Œç³»ç»Ÿä¸ä¼šè¾“å‡ºé”™è¯¯ç­”æ¡ˆï¼Œè€Œæ˜¯è¿›å…¥ Rewrite èŠ‚ç‚¹ã€‚LLM ä¼šå°†ç”¨æˆ·æ¨¡ç³Šçš„è¾“å…¥ä¼˜åŒ–ä¸ºæ›´é€‚åˆæ£€ç´¢çš„ä¸“ä¸šæé—®ï¼ˆQuery Optimizationï¼‰ï¼Œå¹¶è‡ªåŠ¨è§¦å‘é‡è¯•ã€‚

é—­çŽ¯æœºåˆ¶: Retrieve -> Generate -> Reflect -> (Rewrite -> Retrieve) çš„åŠ¨æ€å¾ªçŽ¯ç¡®ä¿äº†å›žç­”çš„é«˜è´¨é‡ã€‚

ðŸ§© æŠ€æœ¯æ ˆ (Tech Stack)
LLM Runtime: Ollama (Running Qwen2.5-7B-Int4)

Framework: LangChain & LangGraph

Vector DB: ChromaDB

Embedding: moka-ai/m3e-base (Optimized for Chinese/English semantic matching)

Reranker: BAAI/bge-reranker-base

Retrieval Algorithm: BM25 + Dense Vector Search (Hybrid)

ðŸš€ å¿«é€Ÿå¼€å§‹ (Quick Start)
1. çŽ¯å¢ƒå‡†å¤‡
Bash

# å…‹éš†ä»“åº“
git clone https://github.com/YourName/IELTS-Tutor-RAG.git
cd IELTS-Tutor-RAG

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
2. æž„å»ºçŸ¥è¯†åº“
å°†ä½ çš„é›…æ€èµ„æ–™ PDF æ”¾å…¥ data/ ç›®å½•ï¼Œç„¶åŽè¿è¡Œï¼š

Bash

# è¿™ä¸€æ­¥ä¼šè¿›è¡Œæ¸…æ´—ã€åˆ‡åˆ†ã€å‘é‡åŒ–å¹¶å­˜å…¥ Chroma
python build.py
3. å¯åŠ¨æ™ºèƒ½ä½“
Bash

# å¯åŠ¨å¸¦æœ‰è‡ªæˆ‘åæ€åŠŸèƒ½çš„é«˜çº§ Agent
python agent_rag.py
ðŸ“‚ ç›®å½•ç»“æž„ (Directory Structure)
Plaintext

.
â”œâ”€â”€ data/               # å­˜æ”¾é›…æ€ PDF èµ„æ–™
â”œâ”€â”€ vector_db/          # Chroma å‘é‡æ•°æ®åº“ (è‡ªåŠ¨ç”Ÿæˆ)
â”œâ”€â”€ build.py            # æ•°æ®æ¸…æ´—ä¸Žå»ºåº“è„šæœ¬ (ETL Pipeline)
â”œâ”€â”€ ragchat.py          # åŸºç¡€ç‰ˆ RAG (ç”¨äºŽå¯¹æ¯”æµ‹è¯•)
â”œâ”€â”€ agent_rag.py        # è¿›é˜¶ç‰ˆ Agent (æ ¸å¿ƒä¸»ç¨‹åº - LangGraph)
â””â”€â”€ requirements.txt    # ä¾èµ–åŒ…
âœ… ä¼˜åŒ–å»ºè®®æ€»ç»“
çªå‡ºå¯¹æ¯”ï¼šæŠŠä½ åŽŸæœ¬çš„æè¿°æ‹†æˆäº†â€œç¬¬ä¸€é˜¶æ®µâ€å’Œâ€œç¬¬äºŒé˜¶æ®µâ€ã€‚è¿™ç§å†™æ³•éžå¸¸è®¨å–œï¼Œå› ä¸ºå®ƒå±•ç¤ºäº†ä½ çš„æ€è€ƒè¿‡ç¨‹ï¼ˆå‘çŽ°äº†ä»€ä¹ˆé—®é¢˜ -> ç”¨ä»€ä¹ˆæŠ€æœ¯è§£å†³äº†å®ƒï¼‰ã€‚

ä¸“ä¸šæœ¯è¯­åŠ ç²—ï¼šæˆ‘å¯¹ BM25ã€Cross-Encoderã€Self-Reflectionã€LangGraph ç­‰è¯è¿›è¡Œäº†åŠ ç²—ï¼Œæ–¹ä¾¿é¢è¯•å®˜æˆ– HR æ‰«è§†æ—¶ä¸€çœ¼çœ‹åˆ°ä½ çš„æŠ€æœ¯äº®ç‚¹ã€‚

å¢žåŠ  Mermaid æµç¨‹å›¾ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æžœä½ æƒ³æ›´ç‚«é…·ï¼Œå¯ä»¥åœ¨ README é‡ŒåŠ ä¸€ä¸ªæµç¨‹å›¾ä»£ç ï¼ˆGithub ä¼šè‡ªåŠ¨æ¸²æŸ“ï¼‰ï¼Œå±•ç¤ºä½ çš„ LangGraph é€»è¾‘ï¼š

Code snippet

graph TD
    A[ç”¨æˆ·æé—®] --> B(æ£€ç´¢ Retrieve);
    B --> C{æ–‡æ¡£è¯„åˆ†};
    C -- æ— ç›¸å…³æ–‡æ¡£ --> D[æŸ¥è¯¢æ”¹å†™ Rewrite];
    C -- æœ‰æ–‡æ¡£ --> E(ç”Ÿæˆ Generate);
    E --> F{è‡ªæˆ‘åæ€ Check};
    F -- æœ‰å¹»è§‰ --> D;
    D --> B;
    F -- é€šè¿‡ --> G[æœ€ç»ˆè¾“å‡º];